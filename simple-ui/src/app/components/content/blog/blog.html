<div class="blog-container">
    <h1 class="blog-heading">Blog</h1>
    
    <div class="blog-controls">
        <input 
            type="text" 
            class="search-input" 
            [(ngModel)]="searchQuery" 
            placeholder="Search posts..."
        >
        
        <div class="filter-tags">
            @for (tag of availableTags; track tag.id) {
                <button 
                    class="filter-tag"
                    [class.active]="selectedTag === tag.name"
                    (click)="filterByTag(tag.name)"
                >
                    {{ tag.name }}
                </button>
            }
        </div>
    </div>

    @if (isLoading) {
        <div class="loading">Loading posts...</div>
    }

    @if (!isLoading) {
        <div class="blog-grid">
            @for (post of filteredPosts; track post.id; let first = $first) {
                <a [routerLink]="['/blog', post.id]" class="blog-card-link">
                    <div class="blog-card" [class.featured]="first">
                        <div class="blog-card-background" [style.background]="getCardBackground(post)">
                            <span class="blog-emoji">{{ post.emoji }}</span>
                        </div>
                        <div class="blog-card-content">
                            <h2 class="blog-title">{{ post.title }}</h2>
                            <p class="blog-excerpt">{{ post.excerpt }}</p>
                            <div class="blog-meta">
                                <span class="read-time">{{ post.readTime }} min read</span>
                                <span class="publish-date">{{ post.publishedAt | date:'MMM d, yyyy' }}</span>
                            </div>
                            <div class="blog-tags">
                                @for (tag of post.tags; track tag.id) {
                                    <span class="tag">{{ tag.name }}</span>
                                }
                            </div>
                        </div>
                    </div>
                </a>
            }
        </div>

        @if (filteredPosts.length === 0) {
            <div class="no-posts">
                <p>No posts found matching your criteria.</p>
            </div>
        }

        <!-- Pagination Controls -->
        @if (totalPages > 1) {
            <div class="pagination">
                <button 
                    class="pagination-btn" 
                    (click)="previousPage()"
                    [disabled]="currentPage === 0"
                >
                    ← Previous
                </button>

                <div class="pagination-numbers">
                    @if (pageNumbers[0] > 0) {
                        <button class="pagination-number" (click)="goToPage(0)">1</button>
                        @if (pageNumbers[0] > 1) {
                            <span class="pagination-ellipsis">...</span>
                        }
                    }

                    @for (page of pageNumbers; track page) {
                        <button 
                            class="pagination-number"
                            [class.active]="page === currentPage"
                            (click)="goToPage(page)"
                        >
                            {{ page + 1 }}
                        </button>
                    }

                    @if (pageNumbers[pageNumbers.length - 1] < totalPages - 1) {
                        @if (pageNumbers[pageNumbers.length - 1] < totalPages - 2) {
                            <span class="pagination-ellipsis">...</span>
                        }
                        <button class="pagination-number" (click)="goToPage(totalPages - 1)">
                            {{ totalPages }}
                        </button>
                    }
                </div>

                <button 
                    class="pagination-btn" 
                    (click)="nextPage()"
                    [disabled]="currentPage === totalPages - 1"
                >
                    Next →
                </button>
            </div>

            <div class="pagination-info">
                Showing {{ currentPage * pageSize + 1 }} - {{ Math.min((currentPage + 1) * pageSize, totalElements) }} of {{ totalElements }} posts
            </div>
        }
    }
</div>